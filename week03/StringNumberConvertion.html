<!-- 
1231    十进制
0b1011  二进制
0o1011  八进制
10.3e10 科学计数法
0x1011  十六进制
 -->

<script>
  function convertStringToNumber(string, base = 10) {
    let reg = /^[\+\-]?(0\.?$|0[bB][01]+$|0[oO][0-7]+$|0[xX][0-9a-fA-F]+$|([1-9]\d*\.?\d*|0?\.\d+)([eE][\+\-]\d+))?$/;
    if (!reg.test(string)) return NaN;

    let chars = string.split('');
    let number = 0;
    let i = 0;
    let zeroCodePoint = '0'.codePointAt(0);

    if (chars.length > 2 && base != 10) { // 如果不是十进制, 从第3位开始读
      if (base == 16 && (string.substring(0, 2) != '0x' || string.substring(0, 2) != '0X')) {
        console.log('不是有效的十六进制')
        return NaN;
      } else if (base == 8 && (string.substring(0, 2) != '0o' || string.substring(0, 2) != '0O')) {
        console.log('不是有效的八进制');
        return NaN;
      } else if (base == 2 && (string.substring(0, 2) != '0b' || string.substring(0, 2) != '0B')) {
        console.log('不是有效的二进制');
        return NaN;
      }
      i = 2;
    }

    // 小数位前面的值 或科学计数法前的值
    while (i < chars.length && chars[i] !== '.' && !(base == 10 && chars[i].toUpperCase() === 'E')) {
      number = number * base;
      // 如果是十六进制
      let upperCaseChar = chars[i].toUpperCase();
      if (base == 16 && upperCaseChar.codePointAt(0) >= 'A'.codePointAt(0)) {
        number += (upperCaseChar.codePointAt(0) - 'A'.codePointAt(0)) + 10
      } else {
        number += chars[i].codePointAt(0) - zeroCodePoint;
      }
      i++;
    }

    // 小数点 或 科学计数法
    if (chars[i] === '.' || (base == 10 && chars[i].toUpperCase() === 'E')) {
      i++;
    }

    // 小数位
    let fraction = 1;
    while (i < chars.length && !(base == 10 && chars[i].toUpperCase() === 'E')) {
      fraction = fraction / base;
      number += (chars[i].codePointAt(0) - zeroCodePoint) * fraction;
      i++;
    }

    // 科学计数
    let isNegative = false;
    if (base == 10 && chars[i].toUpperCase() === 'E') { // 科学计数法
      i++;
      if (i < chars.length && chars[i] === '-') { // 负的幂
        isNegative = true;
        i++;
      } else if (i < chars.length && chars[i] === '+') {
        i++;
      }

      let power = 0; // 幂的值
      while (i < chars.length) {
        power = power * base;
        power += chars[i].codePointAt(0) - zeroCodePoint;
        i++;
      }
      number = number * Math.pow(base, isNegative ? -1 * power : power);
    }
    return number;
  }



  function convertNumberToString(number, base = 10) {
    if(base != 10){ // 非十进制转成十进制
      number = parseInt(number, 10);
      base = 10;
    } 

    let integer = Math.floor(number);
    let fraction = number - integer;
    let str = '';

    while (integer > 0) {
      console.log(integer, str);
      str = String(integer % base) + str;
      integer = Math.floor(integer / base);
    }
    return str;
  }
</script>